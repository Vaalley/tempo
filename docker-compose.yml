services:
    # --- BASES DE DONNÃ‰ES ---
    postgres:
        image: postgres:18-alpine
        container_name: tempo_postgres
        restart: always
        environment:
            POSTGRES_USER: admin
            POSTGRES_PASSWORD: password123
            POSTGRES_DB: tempo_db
        ports:
            - '5432:5432'
        volumes:
            - postgres_data:/var/lib/postgresql/data

    mongo:
        image: mongo:8-noble
        container_name: tempo_mongo
        restart: always
        environment:
            MONGO_INITDB_ROOT_USERNAME: admin
            MONGO_INITDB_ROOT_PASSWORD: password123
        ports:
            - '27017:27017'
        volumes:
            - mongo_data:/data/db

    # --- BACKEND (Hono) ---
    backend:
        build:
            context: .
            dockerfile: apps/backend/Dockerfile
        container_name: tempo_backend
        restart: always
        ports:
            - '3000:3000'
        environment:
            # Attention : ici on utilise le nom du service "postgres" et plus "localhost" !
            DATABASE_URL: 'postgres://admin:password123@postgres:5432/tempo_db'
        depends_on:
            - postgres
            - mongo

    # --- FRONTEND (Svelte) ---
    frontend:
        build:
            context: .
            dockerfile: apps/frontend/Dockerfile
        container_name: tempo_frontend
        restart: always
        ports:
            - '5173:3000' # On mappe le port 3000 interne du conteneur vers 5173 externe
        environment:
            # L'URL publique du backend pour le navigateur
            PUBLIC_API_URL: 'http://localhost:3000'
        depends_on:
            - backend

volumes:
    postgres_data:
    mongo_data:
